<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Murottal Kemenag App</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    
    <style>
    :root {
        --primary: #009860; 
        --primary-dark: #007046;
        --primary-light: #E0F2E9;
        --text-main: #1F2937;
        --text-muted: #6B7280;
        --bg-body: #F3F4F6;
        --surface: #FFFFFF; 
        --shadow-card: 0 4px 20px -5px rgba(0,0,0,0.06);
        --radius-card: 24px;
        --nav-height: 60px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; }
    body { background-color: var(--bg-body); display: flex; justify-content: center; min-height: 100vh; overflow: hidden; }
    #app { width: 100%; max-width: 440px; background: var(--bg-body); height: 100dvh; display: flex; flex-direction: column; position: relative; overflow: hidden; padding-top: env(safe-area-inset-top); padding-top: constant(safe-area-inset-top); }

    @media(min-width: 450px) {
        #app { height: 95vh; margin-top: 2.5vh; border-radius: 36px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); overflow: hidden; background: #fff; }
    }

    /* VIEW LAYOUT */
    .view-container { height: 100%; width: 100%; overflow-y: auto; overflow-x: hidden; position: relative; background: #F9FAFB; padding-bottom: 80px; }
    .view-section { display: none; min-height: 100%; flex-direction: column; animation: fadeIn 0.4s ease; }
    .view-section.active { display: flex; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* HEADER & SEARCH */
    .header { padding: 35px 24px 20px; background: #ffffff; position: relative; z-index: 20; border-bottom: 1px solid rgba(0, 0, 0, 0.03); }
    .header h1 { font-size: 24px; font-weight: 800; color: var(--text-main); letter-spacing: -0.5px; }
    .header p { color: var(--text-muted); font-size: 14px; margin-top: 2px; }
    .search-wrap { margin-top: 18px; position: relative; }
    .search-wrap i { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: #9CA3AF; }
    .search-input { width: 100%; padding: 16px 16px 16px 48px; border: 2px solid transparent; background: #F3F4F6; border-radius: 18px; font-size: 14px; outline: none; transition: 0.3s; color: var(--text-main); font-weight: 500; }
    .search-input:focus { background: #fff; border-color: var(--primary); box-shadow: 0 4px 20px rgba(0, 152, 96, 0.15); }

    /* CARD LIST */
    .content-list { padding: 15px; display: flex; flex-direction: column; gap: 16px; padding-bottom: 20px; }
    .card { background: var(--surface); padding: 20px; border-radius: var(--radius-card); box-shadow: var(--shadow-card); display: flex; justify-content: space-between; align-items: flex-start; position: relative; overflow: hidden; transition: transform 0.2s, box-shadow 0.2s; border: 1px solid rgba(0, 0, 0, 0.02); cursor: pointer; min-height: 100px; }
    .card:active { transform: scale(0.98); }
    .card::before { content: ''; position: absolute; right: -30px; bottom: -34px; width: 150px; height: 150px; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%23009860' d='M44.7,-76.4C58.9,-69.2,71.8,-59.1,81.6,-46.6C91.4,-34.1,98.2,-19.2,95.8,-5.3C93.5,8.6,82.1,21.5,70.9,32.4C59.7,43.3,48.7,52.2,36.5,60.2C24.3,68.2,10.9,75.3,-1.3,77.5C-13.5,79.8,-25.7,77.1,-37.2,70.6C-48.7,64.1,-59.4,53.8,-68.2,41.9C-77,30,-83.8,16.5,-84.3,2.7C-84.8,-11.2,-78.9,-25.3,-69.6,-36.8C-60.3,-48.3,-47.6,-57.2,-34.7,-64.9C-21.8,-72.6,-8.7,-79.1,5.2,-88.1L19.1,-97.1' transform='translate(100 100)' /%3E%3C/svg%3E"); background-repeat: no-repeat; opacity: 0.05; z-index: 0; pointer-events: none; transition: 0.3s; }
    
    .info { display: flex; align-items: center; gap: 16px; z-index: 1; position: relative; flex: 1; }
    .badge { width: 44px; height: 44px; background: var(--primary-light); color: var(--primary-dark); border-radius: 14px; display: flex; justify-content: center; align-items: center; font-weight: 700; font-size: 14px; flex-shrink: 0; margin-top: 2px; }
    .details h3 { font-size: 16px; font-weight: 700; color: var(--text-main); margin-bottom: 2px; line-height: 1.3; }
    .details .meaning { font-size: 12px; font-weight: 500; color: var(--text-muted); opacity: 0.9; }
    .meta-tags { display: flex; align-items: center; gap: 10px; margin-top: 10px; }
    .tag { display: flex; align-items: center; gap: 0px; font-size: 10px; font-weight: 600; color: var(--text-muted); background: #F3F4F6; padding: 4px 6px; border-radius: 8px; transition: 0.3s; }
    .tag i { font-size: 11px; margin-right: 2px; }
    
    .actions { display: flex; flex-direction: column; justify-content: center; align-items: flex-end; z-index: 1; position: relative; min-width: 90px; gap: 8px; }
    .arabic { font-family: 'Scheherazade New', serif; font-size: 26px; font-weight: 700; color: var(--primary); line-height: 1; text-align: right; margin-top: -1px; margin-bottom: 12px; }
    
    /* PLAYER & PROGRESS RING STYLES (FIXED) */
    .player-wrap { display: flex; align-items: center; gap: 10px; margin-top: -5px; padding-bottom: 5px; }
    .timer { font-size: 11px; font-weight: 700; color: var(--primary); font-variant-numeric: tabular-nums; opacity: 0; transition: 0.3s; transform: translateX(5px); }

    .btn-play-circle {
        position: relative;
        width: 35px;
        height: 35px;
        display: flex;
        justify-content: center;
        align-items: center;
        background: #fff;
        border-radius: 50%;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        transition: 0.3s;
        z-index: 2; /* Di atas background card */
    }

    .btn-play-circle i { 
        font-size: 17px;
        color: var(--text-main);
        z-index: 10; /* Icon paling atas */
        position: relative;
    }

    .progress-svg {
        position: absolute;
        top: 0;
        left: 0;
        transform: rotate(-90deg);
        z-index: 5; /* Di atas background tombol, di bawah icon */
        pointer-events: none;
    }

    /* Warna track lebih pekat agar terlihat */
    .prog-bg { 
        fill: none; 
        stroke: #E5E7EB; /* Abu-abu solid */
    }
    
    .prog-bar { 
        fill: none; 
        stroke: var(--primary); 
        stroke-linecap: round; 
        transition: stroke-dashoffset 0.1s linear; 
    }

    .btn-read-arrow { width: 32px; height: 32px; background: var(--primary-light); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: var(--primary-dark); margin-top: 5px; }

    /* CARD ACTIVE STATES */
    .card.active { background: linear-gradient(135deg, #009860 0%, #007046 100%); box-shadow: 0 15px 30px -5px rgba(0, 152, 96, 0.4); }
    .card.active .badge { background: rgba(255, 255, 255, 0.2); color: #fff; }
    .card.active h3, .card.active .meaning { color: #fff; }
    .card.active .meaning { opacity: 0.8; }
    .card.active .tag { background: rgba(255, 255, 255, 0.15); color: #fff; }
    .card.active .arabic { color: #fff; }
    .card.active::before { opacity: 0.15; filter: brightness(2); }
    .card.active .timer { opacity: 1; transform: translateX(0); color: #D1FAE5; }
    
    .card.active .btn-play-circle { background: #fff; }
    .card.active .btn-play-circle i { color: var(--primary-dark); }
    
    /* Saat aktif, track jadi semi-transparan putih, bar jadi putih solid */
    .card.active .prog-bg { stroke: rgba(0, 0, 0, 0.1); } 
    .card.active .prog-bar { stroke: var(--primary); }

    /* OTHER COMPONENTS */
    .loading, .empty-state { text-align: center; color: var(--text-muted); padding: 60px 20px; font-weight: 500; font-size: 14px; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; width: 100%; }
    .empty-state i { font-size: 48px; margin-bottom: 10px; color: #E5E7EB; }
    .spin { animation: spin 1s linear infinite; }
    @keyframes spin { 100% { transform: rotate(360deg); } }

    /* EXPLORE */
    .explore-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; padding: 16px 20px 20px; }
    .exp-card { background: #fff; border-radius: 20px; padding: 20px; display: flex; flex-direction: column; justify-content: center; align-items: flex-start; box-shadow: 0 4px 15px rgba(0,0,0,0.03); border: 1px solid rgba(0,0,0,0.02); transition: all 0.2s ease; height: 140px; position: relative; overflow: hidden; cursor: pointer; }
    .exp-card:active { transform: scale(0.96); }
    .exp-icon { width: 44px; height: 44px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 20px; margin-bottom: 12px; transition: 0.3s; }
    .exp-blue .exp-icon { background: #EFF6FF; color: #3B82F6; }
    .exp-purple .exp-icon { background: #F5F3FF; color: #8B5CF6; }
    .exp-orange .exp-icon { background: #FFF7ED; color: #F97316; }
    .exp-teal .exp-icon { background: #F0FDFA; color: #14B8A6; }
    .exp-card h4 { font-size: 15px; font-weight: 700; color: var(--text-main); margin-bottom: 2px; }
    .exp-card span { font-size: 11px; color: var(--text-muted); font-weight: 500; }
    .exp-card::after { content: ''; position: absolute; width: 80px; height: 80px; background: currentColor; border-radius: 50%; opacity: 0.03; right: -20px; bottom: -20px; pointer-events: none; }
    .exp-blue { color: #3B82F6; } .exp-purple { color: #8B5CF6; } .exp-orange { color: #F97316; } .exp-teal { color: #14B8A6; }

    /* OVERLAYS */
    .overlay-view { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 50; display: none; flex-direction: column; transform: translateX(100%); transition: transform 0.3s ease-in-out; }
    .overlay-view.open { transform: translateX(0); display: flex; }
    .detail-header { height: 70px; display: flex; align-items: center; padding: 0 20px; border-bottom: 1px solid #f0f0f0; background: #fff; flex-shrink: 0; gap: 15px; }
    .btn-back { width: 40px; height: 40px; border-radius: 12px; border: 1px solid #eee; background: #fff; display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--text-main); }
    .detail-title h2 { font-size: 18px; font-weight: 700; color: var(--text-main); }
    .detail-title p { font-size: 12px; color: var(--text-muted); }
    .detail-content { flex: 1; overflow-y: auto; padding: 20px; background: #fafafa; }

    /* MUSHAF */
    #view-mushaf { background: #fdfdfd; z-index: 60; }
    .mushaf-container { flex: 1; overflow-y: auto; overflow-x: hidden; display: flex; flex-direction: column; align-items: center; padding: 20px 15px; background: #FDFCF8; position: relative; }
    .mushaf-page-text { width: 100%; max-width: 600px; background: transparent; color: #000; font-family: 'Scheherazade New', serif; direction: rtl; text-align: justify; line-height: 2.3; font-size: 28px; padding: 5px; opacity: 0; transition: opacity 0.3s; }
    .mushaf-page-text.loaded { opacity: 1; }
    .ayah-marker { display: inline-block; font-family: 'Scheherazade New', serif; font-size: 0.9em; color: var(--primary); margin: 0 5px; white-space: nowrap; font-weight: 700; }
    .surah-separator { width: 100%; margin: 30px 0 20px; text-align: center; position: relative; display: flex; flex-direction: column; align-items: center; gap: 10px; }
    .surah-box { background: var(--surface); border: 2px solid var(--primary-light); padding: 8px 30px; border-radius: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.03); margin-bottom: 5px; }
    .surah-name-display { font-family: 'Amiri', serif; font-weight: 700; color: var(--primary-dark); font-size: 20px; }
    .bismillah-text { font-family: 'Scheherazade New', serif; font-size: 26px; color: var(--text-main); margin-top: 10px; margin-bottom: 20px; text-align: center; width: 100%; display: block; }
    .mushaf-loader { position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); display: flex; flex-direction: column; align-items: center; color: var(--primary); }
    .mushaf-controls { height: 70px; background: #fff; border-top: 1px solid rgba(0,0,0,0.05); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; box-shadow: 0 -4px 20px rgba(0,0,0,0.03); z-index: 65; }
    .page-input-wrap { display: flex; align-items: center; background: #F3F4F6; padding: 5px 12px; border-radius: 10px; gap: 8px; }
    .page-input { width: 40px; background: transparent; border: none; text-align: center; font-weight: 700; color: var(--text-main); font-size: 14px; outline: none; }
    .page-input-label { font-size: 12px; color: var(--text-muted); font-weight: 500; }
    .nav-btn { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; background: var(--primary-light); color: var(--primary-dark); font-size: 20px; cursor: pointer; }
    .nav-btn:active { transform: scale(0.95); }

    /* DETAIL VERSES */
    .verse-item { background: #fff; border-radius: 20px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.02); border: 1px solid rgba(0,0,0,0.03); }
    .verse-toolbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: #F3F4F6; padding: 8px 12px; border-radius: 12px; }
    .verse-num { font-size: 12px; font-weight: 700; color: var(--primary); background: #fff; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    .verse-opts { display: flex; gap: 15px; } .verse-opts i { font-size: 18px; color: #9CA3AF; cursor: pointer; transition: 0.2s; } .verse-opts i:hover { color: var(--primary); }
    .verse-arabic { font-family: 'Scheherazade New', serif; font-size: 34px; text-align: right; color: var(--text-main); line-height: 2.2; margin-bottom: 25px; direction: rtl; }
    .verse-latin { font-size: 14px; line-height: 1.6; color: #4B5563; text-align: left; }
    .bismillah-header { text-align: center; font-family: 'Scheherazade New', serif; font-size: 30px; color: var(--text-main); margin: 20px 0 40px; }

    /* NAV */
    .bottom-nav { background: #fff; height: 60px; padding: 0 20px; display: flex; justify-content: space-between; align-items: center; border-top: 1px solid rgba(0,0,0,0.04); z-index: 40; position: fixed; bottom: 0; left: 0; right: 0; width: 100%; max-width: 440px; margin: 0 auto; }
    .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; color: #9CA3AF; text-decoration: none; cursor: pointer; padding: 6px 16px; border-radius: 16px; transition: all 0.3s ease; position: relative; gap: 2px; flex: 1; }
    .nav-item i { font-size: 20px; transition: 0.3s; margin-bottom: 0; }
    .nav-item span { font-size: 10px; font-weight: 600; max-height: 0; overflow: hidden; opacity: 0; transition: all 0.3s ease; transform: translateY(5px); }
    .nav-item.active { color: var(--primary); background-color: var(--primary-light); }
    .nav-item.active span { max-height: 20px; opacity: 1; transform: translateY(0); }
    </style>
</head>
<body>

    <div id="app">
        
        <div class="view-container">
            
            <div id="view-murottal" class="view-section active">
                <div class="header">
                    <h1>Murottal</h1>
                    <p>Dengarkan lantunan ayat suci</p>
                    <div class="search-wrap">
                        <input type="text" id="search-murottal" class="search-input" placeholder="Cari surat..." oninput="filterSurah(this.value, 'list-murottal')">
                        <i class="ri-search-2-line"></i>
                    </div>
                </div>
                <div class="content-list" id="list-murottal">
                    <div class="loading"><i class="ri-loader-4-line spin"></i><br><br>Memuat Surat...</div>
                </div>
            </div>

            <div id="view-membaca" class="view-section">
                <div class="header">
                    <h1>Membaca</h1>
                    <p>Baca surat dan terjemahan</p>
                    <div class="search-wrap">
                        <input type="text" id="search-reading" class="search-input" placeholder="Cari surat..." oninput="filterSurah(this.value, 'list-reading')">
                        <i class="ri-search-2-line"></i>
                    </div>
                </div>
                <div class="content-list" id="list-reading">
                    <div class="loading"><i class="ri-loader-4-line spin"></i><br><br>Memuat Daftar...</div>
                </div>
            </div>

            <div id="view-explore" class="view-section">
                <div class="header">
                    <h1>Explore</h1>
                    <p>Fitur penunjang ibadah</p>
                </div>
                <div class="explore-grid">
                    <div class="exp-card exp-blue" onclick="openMushaf()">
                        <div class="exp-icon"><i class="ri-book-open-fill"></i></div>
                        <h4>Per Halaman</h4>
                        <span>Mushaf Teks</span>
                    </div>
                    <div class="exp-card exp-purple" onclick="toast('Fitur Jadwal Sholat')">
                        <div class="exp-icon"><i class="ri-time-line"></i></div>
                        <h4>Jadwal Sholat</h4>
                        <span>Waktu Setempat</span>
                    </div>
                    <div class="exp-card exp-orange" onclick="toast('Fitur Arah Kiblat')">
                        <div class="exp-icon"><i class="ri-compass-discover-line"></i></div>
                        <h4>Arah Kiblat</h4>
                        <span>Pencari Kiblat</span>
                    </div>
                    <div class="exp-card exp-teal" onclick="toast('Lanjut membaca...')">
                        <div class="exp-icon"><i class="ri-bookmark-3-line"></i></div>
                        <h4>Terakhir Baca</h4>
                        <span>Lanjutkan Ayat</span>
                    </div>
                </div>
            </div>

            <div id="view-setting" class="view-section">
                <div class="empty-state">
                    <i class="ri-settings-4-line"></i>
                    <h3>Pengaturan</h3>
                    <p>Sesuaikan aplikasi dengan preferensi Anda.</p>
                </div>
            </div>

        </div>

        <div id="view-detail-surah" class="overlay-view">
            <div class="detail-header">
                <div class="btn-back" onclick="closeDetail()"><i class="ri-arrow-left-line"></i></div>
                <div class="detail-title">
                    <h2 id="det-name">Nama Surat</h2>
                    <p id="det-info">Arti & Jumlah Ayat</p>
                </div>
            </div>
            <div class="detail-content" id="detail-list"></div>
        </div>

        <div id="view-mushaf" class="overlay-view">
            <div class="detail-header">
                <div class="btn-back" onclick="closeMushaf()"><i class="ri-close-line"></i></div>
                <div class="detail-title">
                    <h2>Mushaf Indonesia</h2>
                    <p>Tampilan Teks Halaman</p>
                </div>
            </div>
            <div class="mushaf-container">
                <div id="mushaf-loader" class="mushaf-loader">
                    <i class="ri-loader-4-line spin" style="font-size: 32px;"></i>
                    <span style="font-size: 12px; margin-top: 10px; opacity: 0.7;">Memuat Halaman...</span>
                </div>
                <div id="mushaf-content" class="mushaf-page-text"></div>
            </div>
            <div class="mushaf-controls">
                <div class="nav-btn" onclick="prevPage()"><i class="ri-arrow-left-s-line"></i></div>
                <div class="page-input-wrap">
                    <span class="page-input-label">Hal.</span>
                    <input type="number" id="page-input" class="page-input" value="1" min="1" max="604" onchange="jumpToPage(this.value)">
                </div>
                <div class="nav-btn" onclick="nextPage()"><i class="ri-arrow-right-s-line"></i></div>
            </div>
        </div>

        <nav class="bottom-nav">
            <div class="nav-item active" onclick="switchTab('murottal', this)"><i class="ri-headphone-line"></i><span>Murottal</span></div>
            <div class="nav-item" onclick="switchTab('membaca', this)"><i class="ri-book-open-line"></i><span>Membaca</span></div>
            <div class="nav-item" onclick="switchTab('explore', this)"><i class="ri-compass-3-line"></i><span>Explore</span></div>
            <div class="nav-item" onclick="switchTab('setting', this)"><i class="ri-settings-4-line"></i><span>Setting</span></div>
        </nav>

    </div>
    <audio id="audio"></audio>

    <script>
        let allSurahData = [];
        const audio = document.getElementById('audio');
        let activeAudioId = null;

        fetch('https://equran.id/api/v2/surat')
            .then(r => r.json())
            .then(json => {
                allSurahData = json.data;
                renderMurottalList(allSurahData);
                renderReadingList(allSurahData); 
            })
            .catch(err => {
                document.getElementById('list-murottal').innerHTML = '<div class="loading">Gagal memuat data.</div>';
                document.getElementById('list-reading').innerHTML = '<div class="loading">Gagal memuat data.</div>';
            });

        function renderMurottalList(data) {
            const listEl = document.getElementById('list-murottal');
            listEl.innerHTML = '';
            
            // Konfigurasi SVG Cincin Progress
            const size = 35;
            const stroke = 3;
            const center = size / 2;
            const radius = 16;
            const circumference = 2 * Math.PI * radius;

            const svgRing = `
                <svg class="progress-svg" width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">
                    <circle class="prog-bg" cx="${center}" cy="${center}" r="${radius}" stroke-width="${stroke}" />
                    <circle class="prog-bar" cx="${center}" cy="${center}" r="${radius}" stroke-width="${stroke}" style="stroke-dasharray: ${circumference}; stroke-dashoffset: ${circumference};" />
                </svg>`;

            data.forEach(s => {
                const div = document.createElement('div');
                div.className = 'card';
                div.id = `card-${s.nomor}`;
                div.innerHTML = `
                    <div class="info"> 
                        <div class="badge">${s.nomor}</div>
                        <div class="details">
                            <h3>${s.namaLatin}</h3>
                            <span class="meaning">${s.arti}</span>
                            <div class="meta-tags">
                                <span class="tag">${s.jumlahAyat} Ayat</span>
                                <span class="tag"><i class="ri-map-pin-line"></i> ${s.tempatTurun}</span>
                            </div>
                        </div>
                    </div>
                    <div class="actions">
                        <div class="arabic">${s.nama}</div>
                        <div class="player-wrap">
                            <span class="timer" id="time-${s.nomor}"></span>
                            <div class="btn-play-circle" onclick="togglePlay(event, ${s.nomor}, '${s.audioFull['05']}')">
                                ${svgRing}
                                <i class="ri-play-fill" id="icon-${s.nomor}"></i>
                            </div>
                        </div>
                    </div>
                `;
                listEl.appendChild(div);
            });
        }

        function renderReadingList(data) {
            const listEl = document.getElementById('list-reading');
            listEl.innerHTML = '';
            data.forEach(s => {
                const div = document.createElement('div');
                div.className = 'card';
                div.onclick = () => openDetail(s);
                div.innerHTML = `
                    <div class="info">
                        <div class="badge" style="background: #F3F4F6; color: #374151;">${s.nomor}</div>
                        <div class="details">
                            <h3>${s.namaLatin}</h3>
                            <span class="meaning">${s.arti}</span>
                            <div class="meta-tags"><span class="tag"><i class="ri-map-pin-line"></i> ${s.tempatTurun}</span></div>
                        </div>
                    </div>
                    <div class="actions">
                        <div class="arabic" style="color:var(--text-main); font-size:24px;">${s.nama}</div>
                        <div class="btn-read-arrow"><i class="ri-arrow-right-s-line"></i></div>
                    </div>
                `;
                listEl.appendChild(div);
            });
        }

        function filterSurah(val, targetId) {
            const v = val.toLowerCase();
            const container = document.getElementById(targetId);
            const cards = container.getElementsByClassName('card');
            Array.from(cards).forEach(c => {
                c.style.display = c.innerText.toLowerCase().includes(v) ? 'flex' : 'none';
            });
        }

        function openDetail(surah) {
            const view = document.getElementById('view-detail-surah');
            const list = document.getElementById('detail-list');
            const title = document.getElementById('det-name');
            const info = document.getElementById('det-info');

            title.innerText = surah.namaLatin;
            info.innerText = `${surah.arti} • ${surah.jumlahAyat} Ayat`;
            list.innerHTML = '<div class="loading"><i class="ri-loader-4-line spin"></i><br>Mengambil Ayat...</div>';
            view.classList.add('open'); 

            fetch(`https://equran.id/api/v2/surat/${surah.nomor}`)
                .then(r => r.json())
                .then(res => {
                    const data = res.data;
                    let html = '';
                    if(surah.nomor !== 1 && surah.nomor !== 9) { html += `<div class="bismillah-header">بِسْمِ اللَّهِ الرَّحْمَنِ الرَّحِيمِ</div>`; }
                    data.ayat.forEach(a => {
                        html += `
                            <div class="verse-item">
                                <div class="verse-toolbar">
                                    <div class="verse-num">${a.nomorAyat}</div>
                                    <div class="verse-opts">
                                        <i class="ri-bookmark-line" onclick="toast('Ayat ditandai')"></i>
                                        <i class="ri-share-forward-line" onclick="toast('Tautan disalin')"></i>
                                    </div>
                                </div>
                                <div class="verse-arabic">${a.teksArab}</div>
                                <div class="verse-latin">${a.teksIndonesia}</div>
                            </div>
                        `;
                    });
                    list.innerHTML = html;
                })
                .catch(err => { list.innerHTML = '<div class="empty-state">Gagal memuat ayat.</div>'; });
        }

        function closeDetail() { document.getElementById('view-detail-surah').classList.remove('open'); }

        let currentMushafPage = 1;
        function openMushaf() {
            document.getElementById('view-mushaf').classList.add('open');
            const content = document.getElementById('mushaf-content');
            if(content.innerHTML.trim() === "") { loadMushafText(currentMushafPage); }
        }
        function closeMushaf() { document.getElementById('view-mushaf').classList.remove('open'); }

        function loadMushafText(page) {
            const loader = document.getElementById('mushaf-loader');
            const content = document.getElementById('mushaf-content');
            const input = document.getElementById('page-input');

            content.classList.remove('loaded'); content.style.opacity = '0';
            loader.style.display = 'flex'; input.value = page;

            fetch(`https://api.alquran.cloud/v1/page/${page}/quran-uthmani`)
                .then(r => r.json())
                .then(res => {
                    if(res.code === 200) {
                        renderMushafPage(res.data.ayahs);
                        loader.style.display = 'none'; content.classList.add('loaded'); content.style.opacity = '1';
                    } else { throw new Error('API Error'); }
                })
                .catch(err => { loader.innerHTML = '<i class="ri-close-circle-line" style="font-size: 32px; color: #EF4444"></i><span style="margin-top:10px">Gagal memuat teks.</span>'; });
        }

        function renderMushafPage(ayahs) {
            const content = document.getElementById('mushaf-content');
            let html = '';
            ayahs.forEach(ayah => {
                if (ayah.numberInSurah === 1) {
                    const surahName = ayah.surah.name; 
                    html += `<div class="surah-separator"><div class="surah-box"><span class="surah-name-display">${surahName}</span></div>`;
                    if (ayah.surah.number !== 1 && ayah.surah.number !== 9) { html += `<span class="bismillah-text">بِسْمِ ٱللَّهِ ٱلرَّحْمَٰنِ ٱلرَّحِيمِ</span>`; }
                    html += `</div>`;
                }
                const arabNum = toArabicNumerals(ayah.numberInSurah);
                let text = ayah.text;
                if(ayah.numberInSurah === 1 && ayah.surah.number !== 1 && ayah.surah.number !== 9) { text = text.replace('بِسْمِ ٱللَّهِ ٱلرَّحْمَٰنِ ٱلرَّحِيمِ ', ''); }
                html += `${text} <span class="ayah-marker">۝${arabNum}</span> `;
            });
            content.innerHTML = html;
        }

        function toArabicNumerals(n) { const arabicNumbers = ['٠','١','٢','٣','٤','٥','٦','٧','٨','٩']; return n.toString().replace(/\d/g, d => arabicNumbers[d]); }
        function nextPage() { if(currentMushafPage < 604) { currentMushafPage++; loadMushafText(currentMushafPage); } else { toast("Ini halaman terakhir"); } }
        function prevPage() { if(currentMushafPage > 1) { currentMushafPage--; loadMushafText(currentMushafPage); } else { toast("Ini halaman pertama"); } }
        function jumpToPage(val) { let p = parseInt(val); if(p >= 1 && p <= 604) { currentMushafPage = p; loadMushafText(p); } else { toast("Halaman tidak valid"); document.getElementById('page-input').value = currentMushafPage; } }
        function toast(msg) {
            const existing = document.querySelector('.toast-msg'); if(existing) existing.remove();
            const d = document.createElement('div'); d.className = 'toast-msg';
            d.style.cssText = `position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: rgba(31, 41, 55, 0.9); color: white; padding: 10px 20px; border-radius: 20px; font-size: 12px; z-index: 100; animation: fadeIn 0.3s;`;
            d.innerText = msg; document.body.appendChild(d);
            setTimeout(() => { d.style.opacity = 0; setTimeout(() => d.remove(), 300); }, 2000);
        }
        function switchTab(tabName, element) {
            document.querySelectorAll('.view-section').forEach(view => { view.classList.remove('active'); });
            document.querySelectorAll('.overlay-view').forEach(ov => ov.classList.remove('open'));
            const targetView = document.getElementById(`view-${tabName}`); if (targetView) targetView.classList.add('active');
            document.querySelectorAll('.nav-item').forEach(item => { item.classList.remove('active'); });
            element.classList.add('active');
        }

        function togglePlay(e, id, url) {
            e.stopPropagation();
            if (activeAudioId === id) {
                if(audio.paused) audio.play(); else audio.pause();
            } else {
                if (activeAudioId) resetUI(activeAudioId);
                activeAudioId = id; audio.src = url;
                const card = document.getElementById(`card-${id}`);
                const icon = document.getElementById(`icon-${id}`);
                const time = document.getElementById(`time-${id}`);
                if(card) card.classList.add('active');
                if(icon) icon.className = 'ri-loader-4-line spin';
                if(time) time.innerText = "...";
                audio.play();
            }
        }

        audio.addEventListener('playing', () => { if(activeAudioId) document.getElementById(`icon-${activeAudioId}`).className = 'ri-pause-fill'; });
        audio.addEventListener('pause', () => { if(activeAudioId) document.getElementById(`icon-${activeAudioId}`).className = 'ri-play-fill'; });
        audio.addEventListener('ended', () => { if(activeAudioId) resetUI(activeAudioId); activeAudioId = null; });

        audio.addEventListener('timeupdate', () => {
            if(!activeAudioId) return;
            const dur = audio.duration; const cur = audio.currentTime;
            if(isNaN(dur)) return;
            const left = dur - cur;
            const timeEl = document.getElementById(`time-${activeAudioId}`);
            if(timeEl) timeEl.innerText = "-" + fmt(left);
            
            const ringContainer = document.querySelector(`#card-${activeAudioId} .prog-bar`);
            if(ringContainer) {
                const radius = 16;
                const C = 2 * Math.PI * radius;
                const offset = C - ((cur/dur) * C);
                ringContainer.style.strokeDashoffset = offset;
            }
        });

        function resetUI(id) {
            const card = document.getElementById(`card-${id}`);
            const icon = document.getElementById(`icon-${id}`);
            const ringContainer = document.querySelector(`#card-${id} .prog-bar`);
            const time = document.getElementById(`time-${id}`);
            const C = 2 * Math.PI * 16;
            if(card) card.classList.remove('active');
            if(icon) icon.className = 'ri-play-fill';
            if(time) time.innerText = "";
            if(ringContainer) ringContainer.style.strokeDashoffset = C;
        }

        function fmt(s) { if(s<0) s=0; const m = Math.floor(s/60); const sc = Math.floor(s%60); return `${m}:${sc<10?'0'+sc:sc}`; }
    </script>
</body>
</html>
